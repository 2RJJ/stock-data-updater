      - name: Send Wake-on-LAN to Secondary Mac
        run: |
          MAC="${{ secrets.WOL_MAC }}"
          printf 'f'%s $(seq 1 6) > /tmp/wol.bin
          printf "%s" $MAC | sed 's/://g' | fold -w2 | xargs printf '%s' | \
            awk '{for(i=1;i<=16;i++) printf $0}' >> /tmp/wol.bin
          cat /tmp/wol.bin | xxd -r -p | nc -w1 -u 172.24.255.255 9
          echo "WOL sent to $MAC"

      - name: Wait for Mac to wake (120s + retry SSH)
        run: |
          echo "Waiting 120 seconds for ZeroTier reconnect..."
          sleep 120

          for i in {1..12}; do
            echo "SSH retry $i/12..."
            if ssh -o StrictHostKeyChecking=no -o ConnectTimeout=10 -o BatchMode=yes \
              ${{ secrets.SECONDARY_USER }}@${{ secrets.SECONDARY_HOST }} \
              "echo 'Mac awake on attempt $i' && uptime" 2>/dev/null; then
              echo "SUCCESS: Mac is fully awake and responsive"
              exit 0
            fi
            sleep 10
          done

          echo "FAILED: Mac did not respond after 12 attempts"
          exit 1

      - name: Transfer data to Secondary Mac
        uses: appleboy/scp-action@v0.1.7
        with:
          host: ${{ secrets.SECONDARY_HOST }}
          username: ${{ secrets.SECONDARY_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 22
          source: "stock_data.csv"
          target: "~/stock_data/"
          overwrite: true
